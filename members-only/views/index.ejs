<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
</head>
<body>
  <% if (user) {%>
    <h1>WELCOME BACK <%= user.username %></h1>
    <a href="/log-out">LOG OUT</a>
    <a href="/new-message">Add a message</a>
  <% } else { %>
    <h1>please log in</h1>
    <form action="/log-in" method="POST">
      <label for="username">Username</label>
      <input name="username" placeholder="username" type="text" />
      <label for="password">Password</label>
      <input name="password" type="password" />
      <button>Log In</button>
    </form>
  <%}%>
  <% if (messages.length) {%>
    <% for (message of messages) {%>
      <% if (user) {%>
        <% let sender = users.find(user => user._id.toString() === message.user.toString()) %>
        <p><%= sender.username %></p>
      <% } else { %>
        <p>undefined!3</p>
      <%}%>
      <p><%= message.body %></p>
    <%}%>
  <% } else { %>
    <h2>There are no messages yet!</h2>
  <%}%>

</body>
</html>
